# MCP (Model Context Protocol) सपोर्ट

Autohand में एक बिल्ट-इन MCP क्लाइंट शामिल है जो बाहरी MCP सर्वरों से कनेक्ट होता है, और आपके एजेंट को डेटाबेस, API, ब्राउज़र और किसी भी MCP-संगत सेवा के टूल्स से विस्तारित करता है।

## विषय-सूची

- [अवलोकन](#अवलोकन)
- [त्वरित शुरुआत](#त्वरित-शुरुआत)
- [कॉन्फ़िगरेशन](#कॉन्फ़िगरेशन)
- [स्लैश कमांड](#स्लैश-कमांड)
- [कम्युनिटी MCP रजिस्ट्री](#कम्युनिटी-mcp-रजिस्ट्री)
- [टूल नामकरण](#टूल-नामकरण)
- [नॉन-ब्लॉकिंग स्टार्टअप](#नॉन-ब्लॉकिंग-स्टार्टअप)
- [समस्या निवारण](#समस्या-निवारण)

---

## अवलोकन

MCP, AI एजेंट्स को बाहरी टूल्स से जोड़ने के लिए एक ओपन प्रोटोकॉल है। Autohand का MCP क्लाइंट निम्नलिखित को सपोर्ट करता है:

- **stdio ट्रांसपोर्ट** -- एक चाइल्ड प्रोसेस शुरू करता है और stdin/stdout पर JSON-RPC 2.0 के माध्यम से संवाद करता है
- **SSE ट्रांसपोर्ट** -- Server-Sent Events का उपयोग करके HTTP सर्वर से कनेक्ट होता है (योजनाबद्ध)
- **स्वचालित टूल खोज** -- कनेक्टेड सर्वरों से टूल्स को खोजता और रजिस्टर करता है
- **नेमस्पेस्ड टूल्स** -- बिल्ट-इन टूल्स के साथ टकराव से बचने के लिए MCP टूल्स में प्रीफ़िक्स लगाया जाता है
- **नॉन-ब्लॉकिंग स्टार्टअप** -- सर्वर प्रॉम्प्ट को देरी किए बिना बैकग्राउंड में कनेक्ट होते हैं
- **इंटरैक्टिव प्रबंधन** -- `/mcp` कमांड से सर्वर को चालू/बंद करें

---

## त्वरित शुरुआत

### कम्युनिटी रजिस्ट्री से इंस्टॉल करें

शुरू करने का सबसे तेज़ तरीका कम्युनिटी रजिस्ट्री से पूर्व-कॉन्फ़िगर सर्वर इंस्टॉल करना है:

```bash
# Autohand REPL में
/mcp install filesystem
```

यह सर्वर को आपकी कॉन्फ़िग में जोड़ता है और इसे ऑटो-कनेक्ट करता है। आप पूरी रजिस्ट्री भी ब्राउज़ कर सकते हैं:

```bash
/mcp install
```

### मैनुअल कॉन्फ़िगरेशन

`~/.autohand/config.json` में एक MCP सर्वर जोड़ें:

```json
{
  "mcp": {
    "servers": [
      {
        "name": "filesystem",
        "transport": "stdio",
        "command": "npx",
        "args": ["-y", "@modelcontextprotocol/server-filesystem", "/Users/me/projects"]
      }
    ]
  }
}
```

Autohand को पुनः शुरू करें और सर्वर बैकग्राउंड में स्वचालित रूप से कनेक्ट हो जाएगा।

---

## कॉन्फ़िगरेशन

### कॉन्फ़िग संरचना

```json
{
  "mcp": {
    "enabled": true,
    "servers": [
      {
        "name": "filesystem",
        "transport": "stdio",
        "command": "npx",
        "args": ["-y", "@modelcontextprotocol/server-filesystem", "/tmp"],
        "env": {},
        "autoConnect": true
      }
    ]
  }
}
```

### सर्वर कॉन्फ़िग फ़ील्ड

| फ़ील्ड | प्रकार | आवश्यक | विवरण |
|-------|------|----------|-------------|
| `name` | string | हाँ | सर्वर का अद्वितीय पहचानकर्ता |
| `transport` | `"stdio"` \| `"sse"` | हाँ | ट्रांसपोर्ट प्रकार |
| `command` | string | हाँ (stdio) | सर्वर प्रोसेस शुरू करने का कमांड |
| `args` | string[] | नहीं | कमांड के लिए आर्गुमेंट |
| `url` | string | हाँ (sse) | SSE एंडपॉइंट URL |
| `env` | object | नहीं | सर्वर को पास किए जाने वाले एनवायरनमेंट वेरिएबल |
| `autoConnect` | boolean | नहीं | स्टार्टअप पर ऑटो-कनेक्ट (डिफ़ॉल्ट: `true`) |

### ग्लोबल सेटिंग्स

| फ़ील्ड | प्रकार | डिफ़ॉल्ट | विवरण |
|-------|------|---------|-------------|
| `mcp.enabled` | boolean | `true` | सभी MCP सपोर्ट को सक्षम/अक्षम करें |
| `mcp.servers` | array | `[]` | सर्वर कॉन्फ़िगरेशन की सूची |

---

## स्लैश कमांड

### `/mcp` -- इंटरैक्टिव सर्वर मैनेजर

बिना किसी आर्गुमेंट के `/mcp` चलाने पर एक **इंटरैक्टिव टॉगल सूची** खुलती है:

```
MCP Servers
────────────────────────────────────────────────────────
▸ ● filesystem          enabled (5 tools)
  ○ github              disabled
  ● postgres            error
    Connection refused

↑↓ navigate  ⏎/space toggle  q/esc close
```

- सर्वरों के बीच नेविगेट करने के लिए **एरो कीज़**
- सर्वर को चालू/बंद करने (कनेक्ट/डिस्कनेक्ट) के लिए **स्पेस** या **Enter**
- सूची बंद करने के लिए **q** या **ESC**
- त्रुटि वाले सर्वर को चुनने पर त्रुटि का विवरण दिखाया जाता है

### `/mcp` सबकमांड

| कमांड | विवरण |
|---------|-------------|
| `/mcp` | इंटरैक्टिव सर्वर टॉगल सूची |
| `/mcp connect <name>` | किसी विशिष्ट सर्वर से कनेक्ट करें |
| `/mcp disconnect <name>` | सर्वर से डिस्कनेक्ट करें |
| `/mcp list` | कनेक्टेड सर्वरों के सभी टूल्स की सूची |
| `/mcp tools` | `/mcp list` का उपनाम |
| `/mcp add <name> <cmd> [args]` | कॉन्फ़िग में सर्वर जोड़ें और कनेक्ट करें |
| `/mcp remove <name>` | कॉन्फ़िग से सर्वर हटाएँ |

### उदाहरण

```bash
# मैन्युअल रूप से सर्वर जोड़ें
/mcp add time npx -y @modelcontextprotocol/server-time

# सभी उपलब्ध टूल्स देखें
/mcp list

# सर्वर डिस्कनेक्ट करें
/mcp disconnect time

# सर्वर को स्थायी रूप से हटाएँ
/mcp remove time
```

---

### `/mcp install` -- कम्युनिटी रजिस्ट्री ब्राउज़र

कम्युनिटी रजिस्ट्री से पूर्व-कॉन्फ़िगर MCP सर्वर ब्राउज़ करें और इंस्टॉल करें:

```bash
# श्रेणियों के साथ पूरी रजिस्ट्री ब्राउज़ करें
/mcp install

# किसी विशिष्ट सर्वर को सीधे इंस्टॉल करें
/mcp install filesystem
```

इंटरैक्टिव ब्राउज़र में निम्नलिखित दिखाया जाता है:

- **श्रेणियाँ**: डेवलपर टूल्स, डेटा और डेटाबेस, वेब और API, उत्पादकता, AI और रीज़निंग
- रेटिंग के साथ **फ़ीचर्ड सर्वर**
- ऑटोकम्प्लीट के साथ **खोज**
- इंस्टॉल से पहले **सर्वर विवरण** (विवरण, आवश्यक एनवायरनमेंट वेरिएबल, आवश्यक आर्गुमेंट)

#### उपलब्ध सर्वर

| सर्वर | श्रेणी | विवरण |
|--------|----------|-------------|
| filesystem | डेवलपर टूल्स | फ़ाइलों और डायरेक्टरी को पढ़ना, लिखना और प्रबंधित करना |
| github | डेवलपर टूल्स | GitHub रिपॉज़िटरी, इश्यू और पुल रिक्वेस्ट |
| everything | डेवलपर टूल्स | परीक्षण के लिए रेफ़रेंस MCP सर्वर |
| time | डेवलपर टूल्स | समय और टाइमज़ोन टूल्स |
| postgres | डेटा और डेटाबेस | PostgreSQL डेटाबेस क्वेरी |
| sqlite | डेटा और डेटाबेस | SQLite डेटाबेस ऑपरेशन |
| brave-search | वेब और API | Brave वेब सर्च |
| fetch | वेब और API | वेब पेज प्राप्त करना और पार्स करना |
| puppeteer | वेब और API | Puppeteer के साथ ब्राउज़र ऑटोमेशन |
| slack | उत्पादकता | Slack मैसेजिंग |
| memory | AI और रीज़निंग | स्थायी नॉलेज ग्राफ़ मेमोरी |
| sequential-thinking | AI और रीज़निंग | चरण-दर-चरण रीज़निंग |

#### एनवायरनमेंट वेरिएबल

कुछ सर्वरों को एनवायरनमेंट वेरिएबल की आवश्यकता होती है। इंस्टॉल करते समय, Autohand किसी भी आवश्यक मान के लिए प्रॉम्प्ट करता है:

```bash
/mcp install slack
# निम्नलिखित के लिए प्रॉम्प्ट करता है:
#   SLACK_BOT_TOKEN: xoxb-your-token
#   SLACK_TEAM_ID: T0YOUR_TEAM_ID
```

#### आवश्यक आर्गुमेंट

`filesystem` जैसे सर्वरों को पाथ आर्गुमेंट की आवश्यकता होती है:

```bash
/mcp install filesystem
# प्रॉम्प्ट करता है: अनुमत डायरेक्टरी पाथ
```

---

## टूल नामकरण

MCP टूल्स टकराव से बचने के लिए नेमस्पेस्ड प्रीफ़िक्स के साथ रजिस्टर किए जाते हैं:

```
mcp__<server-name>__<tool-name>
```

उदाहरण के लिए, filesystem सर्वर का `read_file` टूल `mcp__filesystem__read_file` बन जाता है।

जब LLM किसी MCP टूल का उपयोग करने का निर्णय लेता है, तो Autohand स्वचालित रूप से कॉल को सही सर्वर पर रूट करता है।

---

## नॉन-ब्लॉकिंग स्टार्टअप

MCP सर्वर स्टार्टअप के दौरान **बैकग्राउंड में एसिंक्रोनस रूप से कनेक्ट** होते हैं। इसका मतलब है:

1. प्रॉम्प्ट तुरंत दिखाई देता है -- सर्वर के कनेक्ट होने का इंतज़ार नहीं करना पड़ता
2. सर्वर समानांतर रूप से, प्रत्येक स्वतंत्र रूप से कनेक्ट होते हैं
3. सर्वर के कनेक्ट होने के बाद टूल्स उपलब्ध हो जाते हैं
4. यदि कोई सर्वर विफल होता है, तो अन्य सामान्य रूप से जारी रहते हैं (त्रुटियाँ `/mcp` से दिखाई जाती हैं)
5. जब LLM किसी MCP टूल को कॉल करता है, तो Autohand पहले कनेक्शन पूरा होने का इंतज़ार करता है

यह व्यवहार Claude Code और इसी तरह के टूल्स द्वारा MCP को हैंडल करने के तरीके से मेल खाता है -- धीमे सर्वर स्टार्टअप से उपयोगकर्ता कभी ब्लॉक नहीं होता।

---

## समस्या निवारण

### सर्वर कनेक्ट नहीं हो रहा

```bash
# स्थिति जाँचें
/mcp

# पुनः कनेक्ट करने का प्रयास करें
/mcp disconnect <name>
/mcp connect <name>
```

### सामान्य त्रुटियाँ

| त्रुटि | कारण | समाधान |
|-------|-------|-----|
| `Command not found` | पैकेज इंस्टॉल नहीं है | पहले `npx` कमांड को मैन्युअल रूप से चलाएँ |
| `Connection refused` | सर्वर नहीं चल रहा (SSE) | URL और सर्वर की स्थिति सत्यापित करें |
| `Request timed out` | सर्वर प्रतिक्रिया नहीं दे रहा | सर्वर लॉग जाँचें, पुनः शुरू करें |
| `SSE transport not yet implemented` | SSE अभी तक सपोर्टेड नहीं है | stdio ट्रांसपोर्ट का उपयोग करें |

### सर्वर लॉग

MCP सर्वर का stderr आउटपुट आंतरिक रूप से कैप्चर किया जाता है। यदि कोई सर्वर ठीक से काम नहीं कर रहा है, तो जाँचें कि क्या अंतर्निहित कमांड Autohand के बाहर काम करता है:

```bash
npx -y @modelcontextprotocol/server-filesystem /tmp
```

### MCP अक्षम करना

सभी MCP सपोर्ट को अक्षम करने के लिए अपनी कॉन्फ़िग में `mcp.enabled` को `false` पर सेट करें:

```json
{
  "mcp": {
    "enabled": false
  }
}
```

या व्यक्तिगत सर्वरों को ऑटो-कनेक्ट न होने के लिए सेट करें:

```json
{
  "mcp": {
    "servers": [
      {
        "name": "filesystem",
        "transport": "stdio",
        "command": "npx",
        "args": ["-y", "@modelcontextprotocol/server-filesystem"],
        "autoConnect": false
      }
    ]
  }
}
```
